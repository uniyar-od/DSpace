var JsTree = {	
	maxTextLength : 250,
	load : function(e, b, d, a, c, lazyload, showprofile, showall, crisid) {
		$(function() {
			if(lazyload) {
				jQuery("#" + a).jstree({
					core : {
						data : {
							url : e,
							data : function(node) {
								return {
									id : node.id
								}
							}
						}
					},
					plugins : [ "sort" ]
				});				
			}
			else {
				jQuery("#" + a).jstree({
					core : {
						data : {
							url : e,
							dataType : "json",
							data : function(f) {
								return {
									id : f.id
								}
							}
						}
					},
					plugins : [ "sort" ]
				});
				if(showall) {
					jQuery("#" + a).bind("loaded.jstree", function (event, data) {
						jQuery(this).jstree("open_all");
					});
				}
			}
			if(lazyload) {
				jQuery("#" + a)
						.on(
								"changed.jstree",
								function(h, g) {
									var f = g.instance.get_selected(true);
									if (f.length > 0) {
										var i = f[0].id;
										jQuery
												.getJSON(
														e,
														{
															id : i
														},
														function(t) {

														}.bind(this))
									}
								}.bind(this))
				}			
			if(showprofile) {
			jQuery("#" + a)
					.on(
							"changed.jstree",
							function(h, g) {
								var f = g.instance.get_selected(true);
								if (f.length > 0) {
									var i = f[0].id;
									jQuery
											.getJSON(
													b + "/" + i,
													{
														profile : d
													},
													function(t) {
														var k = jQuery("#" + c);
														var s = jQuery(
																"<table/>",
																{
																	"class" : "table table-hover"
																});
														var m = jQuery(
																"<tbody/>")
																.appendTo(s);
														for ( var r in t) {
															var p = jQuery(
																	"<tr/>")
																	.appendTo(m);
															jQuery(
																	"<td><strong>"
																			+ t[r].label
																			+ "</strong></td>")
																	.appendTo(p);
															if (t[r].value.length > 1) {
																var j = jQuery("<td/>");
																var o = jQuery(
																		"<ul/>")
																		.appendTo(
																				j);
																for ( var l in t[r].value) {
																	var n = "";
																	if (t[r].url
																			&& t[r].url == true) {
																		n = this
																				.makeLink(
																						t[r].value[l],
																						t[r].valueUrl[l])
																	} else {
																		n = this
																				.truncateAt(
																						t[r].value[l],
																						this.maxTextLength)
																	}
																	var q = jQuery(
																			"<li>"
																					+ n
																					+ "</li>")
																			.appendTo(
																					o)
																}
																j.appendTo(p)
															} else {
																var n = "";
																if (t[r].value.length > 0) {
																	if (t[r].url
																			&& t[r].url == true) {
																		n = this
																				.makeLink(
																						t[r].value[0],
																						t[r].valueUrl[0])
																	} else {
																		n = this
																				.truncateAt(
																						t[r].value[0],
																						this.maxTextLength)
																	}
																	jQuery(
																			"<td>"
																					+ n
																					+ "</td>")
																			.appendTo(
																					p)
																}
															}
														}
														k.empty();
														s.appendTo(k);
													}.bind(this))
								}
							}.bind(this))
			}else
			{
				var count = 0;
				jQuery("#" + a)
				.on(
					"changed.jstree",
					function(h, g) {
						var f = g.instance.get_selected(true);
						if (f.length > 0 && count > 1) {
							var i = f[0].id;
							window.location.href = "/cris/ou/" + i;
						}else{
							count++;
						}
					}.bind(this));
			}
		}.bind(this))
	},
	truncateAt : function(c, b) {
		var a;
		if (c.length > b) {
			a = c.substr(0, b) + "\u2026"
		} else {
			a = c
		}
		return a
	},
	makeLink : function(b, d) {
		var c = this.truncateAt(b, this.maxTextLength);
		var a = '<a target="_blank" href="' + d + '">' + b + "</a>";
		return a
	}
};

